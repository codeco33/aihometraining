<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
	<mapper namespace="aihometraining.team.workoutLog.mapper.WorkoutLogUserMapper">
	<resultMap type="WorkoutGoal" id="WorkoutGoalResultMap">
			<result	column="workoutGoalCode" 		property="workoutGoalCode"/>
			<result column="memberEmail" 			property="memberEmail"/>
			<result column="workoutGoalContent" 	property="workoutGoalContent"/>
			<result column="workoutGoalStartDate" 	property="workoutGoalStartDate"/>
			<result column="workoutGoalEndDate" 	property="workoutGoalEndDate"/>
			<result column="workoutGoalUpdateDate" 	property="workoutGoalUpdateDate"/>
			<result column="memberUpdateEmail" 		property="memberUpdateEmail"/>
			
		<association property="member" javaType="Member">
			<id 	column="memberEmail" property="memberEmail"/>
		</association>	
	</resultMap>
		
	<resultMap type="WorkoutLogPrivacybounds" id="WorkoutLogPrivacyboundsResultMap">	
			<result	column="workoutLogPrivacyBoundsCode" 		property="workoutLogPrivacyBoundsCode"/>
			<result column="workoutLogPrivacyBoundsContent" 	property="workoutLogPrivacyBoundsContent"/>
	</resultMap>
	
	<resultMap type="EClassCategoryLarge" id="EClassCategoryLargeResultMap">
			<result	column="eClassCategoryLargeCode" 			property="eClassCategoryLargeCode"/>
			<result column="eClassCategoryLargeName" 			property="eClassCategoryLargeName"/>
			<result column="eClassCategoryLargeRegEmail" 		property="eClassCategoryLargeRegEmail"/>
			<result column="eClassCategoryLargeRegDate" 		property="eClassCategoryLargeRegDate"/>
			<result column="eClassCategoryLargeUpdateDate" 		property="eClassCategoryLargeUpdateDate"/>
			<result column="eClassCategoryLargeUpdateEmail" 	property="eClassCategoryLargeUpdateEmail"/>
	</resultMap>
	
	<resultMap type="EClassCategoryMedium" id="EClassCategoryMediumResultMap">
			<result	column="eClassCategoryMediumCode" 			property="eClassCategoryMediumCode"/>
			<result column="eClassCategoryMediumName" 			property="eClassCategoryMediumName"/>
			<result column="eClassCategoryLargeCode" 			property="eClassCategoryLargeCode"/>
			<result column="eClassCategoryLargeName" 			property="eClassCategoryLargeName"/>
			<result column="memberEmail" 						property="memberEmail"/>
			<result column="eClassCategoryMediumRegDate" 		property="eClassCategoryMediumRegDate"/>
			<result column="memberUpdateEmail" 					property="memberUpdateEmail"/>
			<result column="eClassCategoryMediumUpdateDate" 	property="eClassCategoryMediumUpdateDate"/>
	</resultMap>
	
	<resultMap type="EClassCategorySmall" id="EClassCategorySmallResultMap">	
			<result	column="eClassCategorySmallCode" 				property="eClassCategorySmallCode"/>
			<result column="eClassCategorySmallName" 				property="eClassCategorySmallName"/>
			<result column="eClassCategoryMediumCode" 				property="eClassCategoryMediumCode"/>
			<result column="eClassCategoryMediumName" 				property="eClassCategoryMediumName"/>
			<result column="eClassCategoryLargeCode" 				property="eClassCategoryLargeCode"/>
			<result column="eClassCategoryLargeName" 				property="eClassCategoryLargeName"/>
			<result column="memberEmail" 							property="memberEmail"/>
			<result column="eClassCategorySmallRegDate" 			property="eClassCategorySmallRegDate"/>
			<result column="updateMemberEmail" 						property="updateMemberEmail"/>
			<result column="eClassCategorySmallFinalUpdateDate" 	property="eClassCategorySmallFinalUpdateDate"/>
	</resultMap>
	
	<resultMap type="WorkoutLog" id="WorkoutLogResultMap">
			<result	column="workoutLogcode" 				property="workoutLogcode"/>
			<result column="memberEmail" 					property="memberEmail"/>
			<result column="eClassCategorySmallCode" 		property="eClassCategorySmallCode"/>
			<result column="eClassCategorySmallName" 		property="eClassCategorySmallName"/>
			<result column="workoutLogTitle" 				property="workoutLogTitle"/>
			<result column="workoutLogContent" 				property="workoutLogContent"/>
			<result column="workoutGoalPlanCode" 			property="workoutGoalPlanCode"/>
			<result column="eClassTaskDoCode" 				property="eClassTaskDoCode"/>
			<result column="challengeEnterCode" 			property="challengeEnterCode"/>
			<result column="workoutLogPrivacyBoundsCode" 	property="workoutLogPrivacyBoundsCode"/>
			<result column="workoutLogUpdateEmail" 			property="workoutLogUpdateEmail"/>
			<result column="workoutLogDeleteEmail" 			property="workoutLogDeleteEmail"/>
			
			<collection property="fileList" javaType="List" ofType="FileDto">
				<id column="fileIdx" 						property="fileIdx"/>
				<result	column="fileOriginalName" 			property="fileOriginalName"/>
				<result column="fileNewName" 				property="fileNewName"/>
				<result column="filePath" 					property="filePath"/>
				<result column="fileSize" 					property="fileSize"/>
			</collection>
	</resultMap>
	
	<resultMap type="WorkoutGoalPlan" id="WorkoutGoalPlanResultmap">
		<result	column="workoutLogcode" 					property="workoutLogcode"/>
		<result column="memberEmail" 						property="memberEmail"/>
		<result column="workoutLogLikeCount" 				property="workoutLogLikeCount"/>
		<result column="workoutGoalCode" 					property="workoutGoalCode"/>
		<result column="workoutGoalPlanStartDate" 			property="workoutGoalPlanStartDate"/>
		<result column="workoutGoalPlanFinalDate" 			property="workoutGoalPlanFinalDate"/>
		<result column="workoutGoalPlanContent" 			property="workoutGoalPlanContent"/>
		<result column="workoutGoalPlanUpdateEmail" 		property="workoutGoalPlanUpdateEmail"/>
		<result column="workoutGoalPlanFinalUpdateTime" 	property="workoutGoalPlanFinalUpdateTime"/>
		<result column="fileIdx" 							property="fileIdx"/>
		<result column="AIWorkoutPerformanceCount" 			property="AIWorkoutPerformanceCount"/>
		<result column="AIWorkoutPerformanceGoal" 			property="AIWorkoutPerformanceGoal"/>
		<result column="workoutGoalPlanAchieveState" 		property="workoutGoalPlanAchieveState"/>
		<result column="workoutGoalPlanCategoryCode" 		property="workoutGoalPlanCategoryCode"/>	
	</resultMap>
	
	<resultMap type="WorkoutLogLike" id="WorkoutLogLikeResultmap">
		<result	column="workoutLogLikeNum" 				property="workoutLogLikeNum"/>
		<result column="workoutLogLikeEmail" 			property="workoutLogLikeEmail"/>
		<result column="workoutLogcode" 				property="workoutLogcode"/>
		<result column="workoutLogLikeRegDate" 			property="workoutLogLikeRegDate"/>
		
		<association property="member" javaType="Member">
			<id 	column="memberEmail" property="memberEmail"/>
		</association>	
		
		<association property="workoutLog" javaType="WorkoutLog">
			<id 	column="workoutLogcode" 				property="workoutLogcode"/>
			<result column="memberEmail" 					property="memberEmail"/>
			<result column="eClassCategorySmallCode" 		property="eClassCategorySmallCode"/>
			<result column="eClassCategorySmallName" 		property="eClassCategorySmallName"/>
			<result column="workoutLogTitle" 				property="workoutLogTitle"/>
			<result column="workoutLogContent" 				property="workoutLogContent"/>
			<result column="workoutGoalPlanCode" 			property="workoutGoalPlanCode"/>
			<result column="eClassTaskDoCode" 				property="eClassTaskDoCode"/>
			<result column="challengeEnterCode" 			property="challengeEnterCode"/>
			<result column="workoutLogPrivacyBoundsCode" 	property="workoutLogPrivacyBoundsCode"/>
			<result column="workoutLogUpdateEmail" 			property="workoutLogUpdateEmail"/>
			<result column="workoutLogDeleteEmail" 			property="workoutLogDeleteEmail"/>
		</association>	
	</resultMap>
	
		<select id="getworkoutLogLikeList" resultMap="WorkoutLogLikeResultmap">
			/* 일지 좋아요 목록 조회 */
			SELECT
				  wl.workoutLogLikeCount
				,wll.workoutLogLikeNum
				,wll.workoutLogLikeEmail
				,wll.workoutLogcode
				,wll.workoutLogLikeRegDate
			FROM
				workoutlog AS wl
				INNER JOIN
				workoutloglike AS wll
				ON 
				wl.workoutLogcode = wll.workoutLogcode
			WHERE
				wl.workoutLogcode = 'workoutLogcode_1';	
	
		</select>
	
		<insert id="workoutLogLikeInsert" parameterType="WorkoutLogLike">
			/* 일지 좋아요 등록 */
			INSERT INTO 
				  workoutloglike
			(
				  workoutLogLikeNum
				, workoutLogLikeEmail
				, workoutLogcode
				, workoutLogLikeRegDate
			)VALUES (
				  #{workoutLogLikeNum}
				, #{workoutLogLikeEmail}
				, #{workoutLogcode}
				, NOW()
			);
		</insert>
	
		<select id="getworkoutLogLikeCount" parameterType="String" resultType="String">
			/* 일지 좋아요 갯수 조회 */
			SELECT
				wl.workoutLogLikeCount
			FROM
				workoutlog AS wl
			WHERE
				wl.workoutLogcode = #{workoutLogcode};
		</select>
		
		<update id="workoutLogLikeCountUpdate" parameterType="String">
			/* 좋아요 카운트 수정 */
			UPDATE 
				workoutlog
			SET
				workoutLogLikeCount=workoutLogLikeCount+1
			WHERE 
				workoutLogcode=#{workoutLogcode};
		</update>
	
	
		<select id="getworkoutLogList" resultMap="WorkoutLogResultMap">
			/* 일지 목록 조회 */
			SELECT 
				  wl.workoutLogcode
				, wl.memberEmail
				, wl.workoutLogLikeCount
				, wl.eClassCategorySmallCode
				, wl.eClassCategorySmallName
				, wl.workoutLogTitle
				, wl.workoutLogContent
				, wl.workoutGoalPlanCode
				, wl.eClassTaskDoCode
				, wl.challengeEnterCode
				, f.fileIdx
				, f.filepath
				, SUBSTRING_INDEX(f.fileOriginalName,'.',1)
				, wl.workoutLogPrivacyBoundsCode
				, wl.workoutLogUpdateEmail
				, wl.workoutLogUpdateFinalDate
				, wl.workoutLogDeleteEmail
			FROM 
				workoutlog AS wl
				LEFT JOIN 
				tb_file_control AS fc
				ON
				wl.workoutLogcode = fc.referenceCode
				LEFT JOIN 
				tb_file AS f
				ON 
				fc.fileIdx = f.fileIdx
			WHERE
				wl.memberEmail = 'id005@email.com';
				
		</select>
		
		
		<select id="getworkoutGoalList" resultMap="WorkoutGoalResultMap">
			/* 운동 목표 목록 */
			SELECT
				 m.memberEmail
				,w.workoutGoalContent
				,w.workoutGoalStartDate
				,w.workoutGoalEndDate
			FROM
				workoutgoal AS w
				JOIN 
				member AS m
				ON 
				w.memberEmail = m.memberEmail
			WHERE
				w.memberEmail = 'id004@email.com';
		</select>
		
		<select id="getworkoutLogPrivacyboundsList" resultType="WorkoutLogPrivacybounds">
			/* 일지 공개범위 목록 조회*/
			SELECT 
				 wp.workoutLogPrivacyBoundsCode
				,wp.workoutLogPrivacyBoundsContent
			FROM
				workoutlogprivacybounds AS wp;
		</select>
		
		<select id="geteClassCategoryLargeList" resultMap="EClassCategoryLargeResultMap">
			/* 운동클래스카테고리large 조회 */
			SELECT
				 ec.eClassCategoryLargeCode
				,ec.eClassCategoryLargeName
			FROM
				eclasscategorylarge AS ec;
		</select>
		
		<select id="geteClassCategoryMedium" resultMap="EClassCategoryMediumResultMap" parameterType="String">
			/* 운동클래스 카테고리 Medium 조회 */
			SELECT
				 em.eClassCategoryMediumCode
				,em.eClassCategoryMediumName
			FROM
				eclasscategorymedium AS em
			Where
				em.eClassCategoryLargeCode = #{eClassCategoryLargeCode};	
		</select>
		
		<select id="geteClassCategorySmall" resultMap="EClassCategorySmallResultMap" parameterType="String">
			/* 운동클래스 카테고리 small 조회 */
			SELECT
				 es.eClassCategorySmallCode
				,es.eClassCategorySmallName
			FROM
				 eclasscategorysmall AS es
			WHERE 	
				 es.eClassCategoryMediumCode = #{eClassCategoryMediumCode};
		</select>
		
		<insert id="workoutLogInsert" parameterType="workoutLog">
			/* 일지 등록 처리 */
			INSERT INTO workoutlog
			(	 workoutLogcode
				,memberEmail
				,eClassCategorySmallCode
				,eClassCategorySmallName
				,workoutLogTitle
				,workoutLogContent
				,workoutGoalPlanCode
				,eClassTaskDoCode
				,challengeEnterCode
				,workoutLogPrivacyBoundsCode
				,workoutLogUpdateEmail
				,workoutLogUpdateFinalDate
				,workoutLogDeleteEmail
			)VALUES (
			 	 #{workoutLogcode}
			 	,#{memberEmail}
			 	,#{eClassCategorySmallCode}
			 	,#{eClassCategorySmallName}
			 	,#{workoutLogTitle}
			 	,#{workoutLogContent}
			 	,#{workoutGoalPlanCode}
			 	,#{eClassTaskDoCode}
			 	,#{challengeEnterCode}
			 	,#{workoutLogPrivacyBoundsCode}
			 	,#{workoutLogUpdateEmail}
			 	,NOW()
			 	,#{workoutLogDeleteEmail}
			);
		
		
		
		
		</insert>
	
	</mapper>